<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Forslag</title>
<style>
  body {
    font-family: 'Minecraft', sans-serif;
    background: #b8d8ff;
    max-width: 600px;
    margin: auto;
    padding: 20px;
    position: relative;
  }
  h1 {
    text-align: center;
    color: #1c3a6b;
    text-shadow: 2px 2px #000;
  }
  textarea {
    width: 100%;
    font-size: 1.1rem;
    padding: 8px;
    margin: 8px 0;
    border: 2px solid #1c3a6b;
    border-radius: 6px;
    box-sizing: border-box;
  }
  button {
    background: #4aa3ff;
    border: none;
    padding: 8px 16px;
    color: white;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 6px;
    margin-left: 5px;
  }
  button:hover { background: #6fb8ff; }
  ul { list-style: none; padding: 0; margin-top: 20px; }
  li {
    background: #6ba8ff;
    margin: 10px 0;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 2px 2px #000;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .vote-btn {
    font-weight: bold;
    margin-left: 5px;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
  }
  .slettBtn {
    background: #ff4d4d;
    border: none;
    color: white;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 4px;
    display: none;
    margin-left: 5px;
  }
  #adminBtn {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #4aa3ff;
    border: none;
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    color: white;
    font-size: 18px;
  }
</style>
</head>
<body>

<button id="adminBtn">⚙</button>

<h1>Legg inn forslag</h1>
<textarea id="forslagInput" rows="4" placeholder="Skriv inn ditt forslag her..."></textarea>
<br>
<button id="leggTilBtn">Legg til forslag</button>

<h2>Tidligere forslag:</h2>
<ul id="forslagListe"></ul>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Din Firebase-konfig
const firebaseConfig = {
  apiKey: "AIzaSyDyNeYw-Im9hggV3Hjbvk58mO0H32QLe7c",
  authDomain: "nettside-8e0fa.firebaseapp.com",
  databaseURL: "https://nettside-8e0fa-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "nettside-8e0fa",
  storageBucket: "nettside-8e0fa.firebasestorage.app",
  messagingSenderId: "310663512384",
  appId: "1:310663512384:web:35df850965b84561a33aa5",
  measurementId: "G-04596EYKV1"
};

  // Initialiser Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const input = document.getElementById('forslagInput');
  const leggTilBtn = document.getElementById('leggTilBtn');
  const liste = document.getElementById('forslagListe');
  const adminBtn = document.getElementById('adminBtn');
  let adminMode = false;

  // Funksjon for å vise forslag
  function visForslag() {
    db.ref('forslag').once('value').then(snapshot => {
      const data = snapshot.val() || {};
      liste.innerHTML = '';

      Object.entries(data).forEach(([id, f]) => {
        const li = document.createElement('li');
        const tekstSpan = document.createElement('span');
        tekstSpan.textContent = f.tekst;
        li.appendChild(tekstSpan);

        const stemDiv = document.createElement('div');

        const upvote = document.createElement('button');
        upvote.textContent = `⬆ ${f.upvote || 0}`;
        upvote.classList.add('vote-btn');

        const downvote = document.createElement('button');
        downvote.textContent = `⬇ ${f.downvote || 0}`;
        downvote.classList.add('vote-btn');

        // Hent stemmer fra localStorage
        let stemmer = JSON.parse(localStorage.getItem('stemmer')) || {};
        const aktuellStemme = stemmer[id] || null;

        upvote.style.background = aktuellStemme === 'upvote' ? 'green' : '#ffd700';
        downvote.style.background = aktuellStemme === 'downvote' ? 'red' : '#ffd700';

        // Upvote
        upvote.addEventListener('click', () => {
          let stemmer = JSON.parse(localStorage.getItem('stemmer')) || {};
          const aktuell = stemmer[id] || null;

          if (aktuell === 'upvote') {
            db.ref(`forslag/${id}/upvote`).transaction(v => v - 1);
            stemmer[id] = null;
          } else {
            if (aktuell === 'downvote') db.ref(`forslag/${id}/downvote`).transaction(v => v - 1);
            db.ref(`forslag/${id}/upvote`).transaction(v => (v || 0) + 1);
            stemmer[id] = 'upvote';
          }

          localStorage.setItem('stemmer', JSON.stringify(stemmer));
          visForslag(); // Oppdater farger og teller
        });

        // Downvote
        downvote.addEventListener('click', () => {
          let stemmer = JSON.parse(localStorage.getItem('stemmer')) || {};
          const aktuell = stemmer[id] || null;

          if (aktuell === 'downvote') {
            db.ref(`forslag/${id}/downvote`).transaction(v => v - 1);
            stemmer[id] = null;
          } else {
            if (aktuell === 'upvote') db.ref(`forslag/${id}/upvote`).transaction(v => v - 1);
            db.ref(`forslag/${id}/downvote`).transaction(v => (v || 0) + 1);
            stemmer[id] = 'downvote';
          }

          localStorage.setItem('stemmer', JSON.stringify(stemmer));
          visForslag();
        });

        stemDiv.appendChild(upvote);
        stemDiv.appendChild(downvote);

        // Slett-knapp
        const slettBtn = document.createElement('button');
        slettBtn.textContent = 'Slett';
        slettBtn.classList.add('slettBtn');
        slettBtn.style.display = adminMode ? 'inline-block' : 'none';
        slettBtn.addEventListener('click', () => {
          db.ref(`forslag/${id}`).remove();
        });

        li.appendChild(stemDiv);
        li.appendChild(slettBtn);
        liste.appendChild(li);
      });
    });
  }

  visForslag(); // Vis forslag ved lasting

  // Legg til forslag
  leggTilBtn.addEventListener('click', () => {
    const tekst = input.value.trim();
    if (!tekst) return;

    db.ref('forslag').once('value').then(snapshot => {
      const eksisterende = snapshot.val() || {};
      if (Object.keys(eksisterende).length >= 10) {
        alert("Det er allerede 10 forslag. Du kan ikke legge til flere.");
        return;
      }
      db.ref('forslag').push({ tekst: tekst, upvote: 0, downvote: 0 });
      input.value = '';
      visForslag();
    });
  });

  // Admin-knapp
  adminBtn.addEventListener('click', () => {
    const passord = prompt("Skriv inn admin-passord:");
    if (passord === "###") { // Bytt med ditt passord
      adminMode = !adminMode;
      alert("Admin-modus aktivert! Du kan nå slette forslag.");
      visForslag();
    } else {
      alert("Feil passord!");
    }
  });
</script>

</body>
</html>
